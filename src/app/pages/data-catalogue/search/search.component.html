<div [nbSpinner]="loading" nbSpinnerSize="giant" nbSpinnerStatus="primary">
  <div class="col-row">
    <nb-card class="minicard">
      <nb-card-body class="d-flex flex-column align-items-center justify-content-center">
        <h2 class="jumbotron-heading">{{ 'DATALET_SEARCH_TITLE' | translate }} {{totalDatasets}} {{ 'DATALET_DATASETS_FROM' | translate }} {{cataloguesInfos.length}} {{ 'DATALET_CATALOGUES' | translate }}!</h2>
        <nb-tag-list (tagRemove)="onTagRemove($event)">
          @for (filter of filters; track $index) {<nb-tag appearance="outline" status="primary" [text]="filter" removable></nb-tag>}
          <input id="tags_input" type="text" nbTagInput (tagAdd)="onTagAdd($event)" [separatorKeys]="[188,13]" fullWidth>
        </nb-tag-list>
        <span class="dataset-found-span"><strong>{{ 'DATALET_DATASETS_FOUND' | translate }}:</strong> {{currentDatasets}}</span>
      </nb-card-body>
    </nb-card>
  </div>

  @if (searchResponse.count==0) {<div class="d-flex flex-column align-items-center justify-content-center">
    <h3 class="jumbotron-heading">{{ 'DATALET_NO_DATASET_FOUND' | translate }}</h3>
  </div>}
  @if (searchResponse.count>0) {<div class="row">
    <div class="col-md-3 col-12">

      <nb-card status="primary">
        <nb-card-header class="d-flex justify-content-between">
          {{ 'HOME_IS_HVD' | translate }}
        </nb-card-header>
        <nb-card-body>
          <div class="d-flex align-items-center mt-2 gap-3">
            <nb-checkbox [checked]="isHVD_Dataset === true" (checkedChange)="toggleHasHVDCategory(true)">Yes</nb-checkbox>
            <nb-checkbox [checked]="isHVD_Dataset === false" (checkedChange)="toggleHasHVDCategory(false)">No</nb-checkbox>
          </div>
        </nb-card-body>
      </nb-card>

      @for (facet of searchResponse.facets; track $index) {<nb-card status="primary">
        <nb-card-header class="d-flex justify-content-between">
          {{facet.displayName}}
          @if (facet.values.length>10) {<span class="d-flex flex-row-reverse">
            @if (getFacetsLimit(facet.displayName.toLowerCase())==10) {<nb-icon icon="arrowhead-down-outline" (click)="setFacetsLimit(facet.displayName.toLowerCase(),facet.values.length)" nbTooltip="{{ 'DATALET_SHOW_ALL' | translate }}"></nb-icon>} @else { @if (getFacetsLimit(facet.displayName.toLowerCase())>10) {<nb-icon icon="arrowhead-up-outline" (click)="setFacetsLimit(facet.displayName.toLowerCase(),10)" nbTooltip="{{ 'DATALET_SHOW_TOP_10' | translate }}"></nb-icon>} }
          </span>}
        </nb-card-header>
        <nb-card-body>
          <nb-list class="no-border">
            @for (item of (filterFacets(facet.search_parameter,facet.values) | slice:0:getFacetsLimit(facet.displayName.toLowerCase())); track $index) {<nb-list-item class="p-1 no-border">
              <a href="javascript:void(0)" (click)="getDatasetByFacet(facet.search_parameter,item.search_value)">{{item.facet}}</a>
            </nb-list-item>}
          </nb-list>
        </nb-card-body>
      </nb-card>}
    </div>
    <div class="col-md-9 col-12">
      <div class="row m-1">
        <pagination-controls (pageChange)="pageChanged($event)"></pagination-controls>
      </div>
      <div class="row m-1">
        <nb-tag-list (tagRemove)="onFilterRemove($event)">
          @for (filter of filtersTags; track $index) {<nb-tag appearance="outline" status="primary" [text]="filter" removable></nb-tag>}
        </nb-tag-list>
      </div>
      <!-- results -->
  @for (dataset of (searchResponse.results | paginate: { itemsPerPage: searchRequest.rows || 10, currentPage: page, totalItems: searchResponse.count }); track $index) {<nb-card class="minicard">
        <nb-card-header>
          <a [routerLink]="[dataset.id]">{{dataset.title}}</a>
        </nb-card-header>
        <nb-card-body class="content-truncated">
          <span class="truncated">{{dataset.description}}</span>
        </nb-card-body>
        <nb-card-footer>
          <nb-tag-list size="small">
            @for (tmp of dataset.distributionFormats; track $index) {<nb-tag text="{{tmp.format}} ({{tmp.count}})" size="tiny" [style.background]="getColor(tmp.format)"></nb-tag>}
          </nb-tag-list>
        </nb-card-footer>
      </nb-card>}
      <div class="row m-1">
        <pagination-controls (pageChange)="pageChanged($event)"></pagination-controls>
      </div>
    </div>
  </div>}
</div>