<div [nbSpinner]="loading" nbSpinnerSize="giant" nbSpinnerStatus="primary">
    <nb-card>
        <nb-card-header>
            <h3>{{dataset.title}}</h3>
        </nb-card-header>
        <nb-card-body>
            @if (dataset.description!='') {<markdown [data]='dataset.description'></markdown>}
            @if (dataset.keywords!=undefined && (dataset.keywords.length>1 || (dataset.keywords.length==1 && dataset.keywords[0]!=''))) {
                <nb-tag-list>
                    @for (k of dataset.keywords; track $index) {
                        <nb-tag size="medium" appearance="outline" status="primary" [text]="k"></nb-tag>
                    }
                </nb-tag-list>
            }
        </nb-card-body>
    </nb-card>
    @if (dataset.distributions!=undefined && dataset.distributions.length>0) {<nb-card>
        <nb-card-header class="d-flex justify-content-between">
            <h5>{{ 'RESOURCES' | translate }} ({{dataset.distributions.length}})</h5>
            @if (dataset.distributions.length>distributionPerPage) {<pagination-controls id="distributions"
                (pageChange)="distributionPage = $event" maxSize="4" directionLinks="true" autoHide="true"
                responsive="true" previousLabel="{{ 'PREVIOUS' | translate }}" nextLabel="{{ 'NEXT' | translate }}" screenReaderPaginationLabel="{{ 'PAGINATION' | translate }}"
                screenReaderPageLabel="page" screenReaderCurrentLabel="{{ 'CURRENT_PAGE' | translate }}"></pagination-controls>}
        </nb-card-header>
        <nb-card-body class="row">
            @for (distribution of (dataset.distributions | paginate: { id: 'distributions', itemsPerPage: distributionPerPage, currentPage: distributionPage, totalItems: dataset.distributions.length }); track $index) {
            <div class="col-md-6 col-sm-12">
                <nb-card>
                    <nb-card-header>
                        <div class="row w-100">
                            <div class="col-12 mb-1">
                                @if (distribution.format!=undefined && distribution.format!='undefined') {<span class="text-wrap">({{distribution.title}}&nbsp;{{distribution.format}})</span>}
                            </div>
                            <div class="col-12">
                                <nb-actions size="small" class="d-flex justify-content-start">
                                    <nb-action icon="file-text-outline" nbTooltip="{{ 'PREVIEW_FILE' | translate }}" [disabled]="!checkDistributionFormat(distribution.format)" (click)="handlePreviewFileOpenModal(distribution)"></nb-action>
                                    <nb-action icon="eye" nbTooltip="{{ 'VIEW_DATALET' | translate }}" [disabled]="!checkDistributionDatalet(distribution)" (click)="openExistingDatalet(distribution)"></nb-action>
                                    @if (enableDatalet) {<nb-action icon="bar-chart-outline" nbTooltip="{{ 'CREATE_DATALET' | translate }}" [disabled]="!checkDistributionDatalet(distribution)" (click)="dataletCreate(distribution)"></nb-action>}
                                    <nb-action icon="download-outline" nbTooltip="{{ 'DOWNLOAD' | translate }}" (click)="downloadUrl(distribution)"></nb-action>
                                    <nb-action icon="info" nbTooltip="{{ 'DETAILS' | translate }}" (click)="openDistributionDetails(distribution)"></nb-action>
                                </nb-actions>
                            </div>
                        </div>
                    </nb-card-header>
                </nb-card>
            </div>
            }
        </nb-card-body>
    </nb-card>}

    <nb-card>
        <nb-card-header>
            <h5>{{ 'ADDITIONAL_INFORMATIONS' | translate }}</h5>
        </nb-card-header>
        <nb-card-body class="content-truncated">

            @if (dataset.landingPage!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'LANDING_PAGE' | translate }}:</label>
                <p class="truncated" ><a [href]="dataset.landingPage" target="_blank">{{dataset.landingPage}}</a></p>
            </span>}

            @if (dataset.publisher!=undefined && dataset.publisher.name!=undefined && (dataset.publisher.name.length>1 || (dataset.publisher.name.length==1 && dataset.publisher.name[0]!=''))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'PUBLISHER_NAME' | translate }}:</label>
                <p class="truncated">{{dataset.publisher.name.join(',')}}</p>
            </span>}
                            
            @if (dataset.publisher!=undefined && dataset.publisher.mbox!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'PUBLISHER_MAIL' | translate }}:</label>
                <p class="truncated">{{dataset.publisher.mbox}}</p>
            </span>}

            @if (dataset.publisher!=undefined && dataset.publisher.homepage!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'PUBLISHER_HOMEPAGE' | translate }}:</label>
                <p class="truncated">{{dataset.publisher.homepage}}</p>
            </span>}

            @if (dataset.publisher!=undefined && dataset.publisher.type!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'PUBLISHER_TYPE' | translate }}:</label>
                <p class="truncated">{{dataset.publisher.type}}</p>
            </span>}

            @if (licenses!=undefined && licenses.length>0) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'LICENSES' | translate }}:</label>
                @for (l of licenses; track $index) {<p class="truncated"><a  [href]="l.uri">{{l.name}}</a></p>}
            </span>}

            @if (dataset.releaseDate!='' && showDate(dataset.releaseDate)) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'RELEASE_DATE' | translate }}:</label>
                <p class="truncated">{{dataset.releaseDate |  date}}</p>
            </span>}

            @if (dataset.updateDate!='' && showDate(dataset.updateDate)) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'UPDATE_DATE' | translate }}:</label>
                <p class="truncated">{{dataset.updateDate |  date}}</p>
            </span>}

            @if (dataset.frequency!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'FREQUENCY' | translate }}:</label>
                <p class="truncated">{{dataset.frequency}}</p>
            </span>}

            @if (dataset.temporalCoverage!=undefined) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'TEMPORAL_COVERAGE' | translate }}:</label>
                <p class="truncated">{{dataset.temporalCoverage.startDate | date}} - {{dataset.temporalCoverage.endDate | date}}</p>
            </span>}

            @if (dataset.language!=undefined && (dataset.language.length>1 || (dataset.language.length==1 && dataset.language[0]!='' && dataset.language[0]!=undefined ))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'LANGUAGES' | translate }}:</label>
                <p class="truncated">{{dataset.language.join(',')}}</p>
            </span>}

            @if (dataset.provenance!=undefined && (dataset.provenance.length>1 || (dataset.provenance.length==1 && dataset.provenance[0]!='' && dataset.provenance[0]!=undefined ))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'PROVENANCES' | translate }}:</label>
                <p class="truncated">{{dataset.provenance.join(',')}}</p>
            </span>}

            @if (dataset.accessRights!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'ACCESS_RIGHTS' | translate }}:</label>
                <p class="truncated">{{dataset.accessRights}}</p>
            </span>}

            @if (dataset.identifier!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'IDENTIFIER' | translate }}:</label>
                <p class="truncated">{{dataset.identifier}}</p>
            </span>}

            @if (dataset.rightsHolder!=undefined && dataset.rightsHolder.name!=undefined && (dataset.rightsHolder.name.length>1 || (dataset.rightsHolder.name.length==1 && dataset.rightsHolder.name[0]!=''))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'RIGHTS_HOLDER_NAME' | translate }}:</label>
                <p class="truncated">{{dataset.rightsHolder.name.join(',')}}</p>
            </span>}
                            
            @if (dataset.rightsHolder!=undefined && dataset.rightsHolder.mbox!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'RIGHTS_HOLDER_MAIL' | translate }}:</label>
                <p class="truncated">{{dataset.rightsHolder.mbox}}</p>
            </span>}

            @if (dataset.rightsHolder!=undefined && dataset.rightsHolder.homepage!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'RIGHTS_HOLDER_HOMEPAGE' | translate }}:</label>
                <p class="truncated">{{dataset.rightsHolder.homepage}}</p>
            </span>}

            @if (dataset.rightsHolder!=undefined && dataset.rightsHolder.type!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'RIGHTS_HOLDER_TYPE' | translate }}:</label>
                <p class="truncated">{{dataset.rightsHolder.type}}</p>
            </span>}

            @if (dataset.creator!=undefined && dataset.creator.name!=undefined && (dataset.creator.name.length>1 || (dataset.creator.name.length==1 && dataset.creator.name[0]!=''))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'CREATOR_NAME' | translate }}:</label>
                <p class="truncated">{{dataset.creator.name.join(',')}}</p>
            </span>}
                            
            @if (dataset.creator!=undefined && dataset.creator.mbox!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'CREATOR_MAIL' | translate }}:</label>
                <p class="truncated">{{dataset.creator.mbox}}</p>
            </span>}

            @if (dataset.creator!=undefined && dataset.creator.homepage!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'CREATOR_HOMEPAGE' | translate }}:</label>
                <p class="truncated">{{dataset.creator.homepage}}</p>
            </span>}

            @if (dataset.creator!=undefined && dataset.creator.type!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'CREATOR_TYPE' | translate }}:</label>
                <p class="truncated">{{dataset.creator.type}}</p>
            </span>}

            @if (dataset.theme!=undefined && (dataset.theme.length>1 || (dataset.theme.length==1 && dataset.theme[0].prefLabel.length!=0 && dataset.theme[0].prefLabel[0].value!=''))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'THEMES' | translate }}:</label>
                <p class="truncated">{{printConcepts(dataset.theme)}}</p>
            </span>}

            @if (dataset.subject!=undefined && (dataset.subject.length>1 || (dataset.subject.length==1 && dataset.subject[0].prefLabel.length!=0 && dataset.subject[0].prefLabel[0].value!=''))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'SUBJETS' | translate }}:</label>
                <p class="truncated">{{printConcepts(dataset.subject)}}</p>
            </span>}

            @if (dataset.source!=undefined && (dataset.source.length>1 || (dataset.source.length==1 && dataset.source[0]!='' && dataset.source[0]!=undefined ))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'SOURCE' | translate }}:</label>
                <p class="truncated">{{dataset.source.join(',')}}</p>
            </span>}

            @if (dataset.documentation!=undefined && (dataset.documentation.length>1 || (dataset.documentation.length==1 && dataset.documentation[0]!='' && dataset.documentation[0]!=undefined ))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'DOCUMENTATION' | translate }}Documentation:</label>
                <p class="truncated">{{dataset.documentation.join(',')}}</p>
            </span>}

            @if (dataset.otherIdentifier!=undefined && (dataset.otherIdentifier.length>1 || (dataset.otherIdentifier.length==1 && dataset.otherIdentifier[0]!='' && dataset.otherIdentifier[0]!=undefined ))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'OTHER_IDENTIFIERS' | translate }}:</label>
                <p class="truncated">{{dataset.otherIdentifier.join(',')}}</p>
            </span>}

            @if (dataset.version!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'VERSION' | translate }}:</label>
                <p class="truncated">{{dataset.version}}</p>
            </span>}

            @if (dataset.versionNotes!=undefined && (dataset.versionNotes.length>1 || (dataset.versionNotes.length==1 && dataset.versionNotes[0]!='' && dataset.versionNotes[0]!=undefined ))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'VERSION_NOTES' | translate }}:</label>
                <p class="truncated">{{dataset.versionNotes.join(',')}}</p>
            </span>}

            @if (dataset.hasVersion!=undefined && (dataset.hasVersion.length>1 || (dataset.hasVersion.length==1 && dataset.hasVersion[0]!='' && dataset.hasVersion[0]!=undefined ))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'HAS_VERISON' | translate }}:</label>
                <p class="truncated">{{dataset.hasVersion.join(',')}}</p>
            </span>}

            @if (dataset.isVersionOf!=undefined && (dataset.isVersionOf.length>1 || (dataset.isVersionOf.length==1 && dataset.isVersionOf[0]!='' && dataset.isVersionOf[0]!=undefined ))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'IS_VERSION_OF' | translate }}:</label>
                <p class="truncated">{{dataset.isVersionOf.join(',')}}</p>
            </span>}

            @if (dataset.sample!=undefined && (dataset.sample.length>1 || (dataset.sample.length==1 && dataset.sample[0]!='' && dataset.sample[0]!=undefined ))) {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'SAMPLE' | translate }}:</label>
                <p class="truncated">{{dataset.sample.join(',')}}</p>
            </span>}

            @if (dataset.spatialCoverage != undefined && dataset.spatialCoverage.geographicalName!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'SPATIAL_COVERAGE_GEOGRAPHICAL_NAME' | translate }}:</label>
                <p class="truncated">{{dataset.spatialCoverage.geographicalName}}</p>
            </span>}

            @if (dataset.spatialCoverage != undefined && dataset.spatialCoverage.geometry!='') {<span class="d-flex flex-column mb-2">
                <label class="label">{{ 'SPATIAL_COVERAGE_GEOMETRY' | translate }}:</label>
                <p class="truncated">{{dataset.spatialCoverage.geometry}}</p>
            </span>}

            @if (dataset.conformsTo!=undefined && ( dataset.conformsTo.length>1 || (
                dataset.conformsTo.length==1 && (dataset.conformsTo[0].identifier!='' 
                || dataset.conformsTo[0].title!='' 
                || dataset.conformsTo[0].description!='')))) {
                <p class="truncated"><span class="label">{{ 'CONFORMS_TO' | translate }}:</span></p>
                 <nb-list>
                    @for (tmp of dataset.conformsTo; track $index) {
                        <nb-list-item class="d-flex flex-column">
                            @if (tmp.identifier!='') {<span>{{tmp.identifier}}</span>}
                            @if (tmp.title!='') {<span>{{tmp.title}}</span>}
                            @if (tmp.description!='') {<span>{{tmp.description}}</span>}
                        </nb-list-item>
                    }
                  </nb-list>                 
            }

            @if (dataset.contactPoint!=undefined && ( dataset.contactPoint.length>1 || 
                (dataset.contactPoint.length==1 &&
                 (dataset.contactPoint[0].fn!='' ||
                 dataset.contactPoint[0].hasEmail!=''
                 || dataset.contactPoint[0].hasURL!=''
                 || dataset.contactPoint[0].hasTelephoneValue!='')))) {
                <p class="truncated"><span class="label">{{ 'CONTACT_POINTS' | translate }}:</span></p>
                 <nb-list>
                    @for (contact of dataset.contactPoint; track $index) {
                        <nb-list-item class="d-flex flex-column">
                            @if (contact.fn!='') {<span><strong>{{contact.fn}}</strong></span>}
                            @if (contact.hasEmail!='') {<span>{{contact.hasEmail}}</span>}
                            @if (contact.hasURL!='') {<span>{{contact.hasURL}}</span>}
                            @if (contact.hasTelephoneValue!='') {<span>{{contact.hasTelephoneValue}}</span>}
                        </nb-list-item>
                    }
                  </nb-list>                 
            }

            

            @for (applicableLegislation of $any(dataset.applicableLegislation); track $index) {
                @if (applicableLegislation!=undefined && applicableLegislation!='') {<span class="d-flex flex-column mb-2">
                    <label class="label">{{ 'APPLICABLE_LEGISLATION' | translate }}:</label>
                    <p class="truncated" class="truncated">{{applicableLegislation}}</p>
                </span>}
            }

            

            @for (HVDCategory of $any(dataset.HVDCategory); track $index) {
                @if (HVDCategory!=undefined && HVDCategory!='') {<span class="d-flex flex-column mb-2">
                    <label class="label">{{ 'HVD_CATEGORY' | translate }}:</label>
                    <p class="truncated" class="truncated">{{HVDCategory}}</p>
                </span>}
            }

        </nb-card-body>
    </nb-card>
</div>